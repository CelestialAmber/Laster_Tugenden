<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<title>Allgemeine Befehle der Göttin</title>
	<style>
		/* latin */
@font-face {
  font-family: 'Playfair Display';
  font-style: normal;
  font-weight: 400;
  src: local('Playfair Display Regular'), local('PlayfairDisplay-Regular'), url(nuFiD-vYSZviVYUb_rj3ij__anPXDTzYgEM86xQ.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
/* latin */
@font-face {
  font-family: 'UnifrakturMaguntia';
  font-style: normal;
  font-weight: 400;
  src: local('UnifrakturMaguntia'), url(WWXPlieVYwiGNomYU-ciRLRvEmK7oaVemGZMFABK1Q.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

		body {

		  max-width: 600px;
		  margin: auto;
		  padding-top: 10px;
		}
		h1{
			text-align: center;
		}
		table {
  			border-collapse: collapse;
		}
		table {
			border:none;
		}
		th, td {
		  border: 1px solid black;
		}
		td {
			width:100pt;
			text-align: center;
		}
		.oben {
			border-top: none;
		}
		.obenleft {
			/*border-left: none;*/
		}
		.obenright {
			/*border-right: none;*/
		}
		#reihe {
			font-weight: bold;
			text-align: center;
			font-size: 150%;

		}
		#ausgewählt {
			font-weight: bold;
			text-align: center;
		}
		.tugend {	
			/*font-family: 'Playfair Display', serif;*/
			color:green;
		}
		.laster {
			/*font-family: 'UnifrakturMaguntia', cursive;*/
			color:red;
		}
		.side {
			width:30pt;
		  	border-left: none;
		  	border-right: none;
		  	text-align: center;	
		}
		.emside {
			width:30pt;
			border:none;
		}
		.status {
			height:50pt;
		}
		.good {
			background-color: lightgreen;
		}
		.evil {
			background-color: pink;
		}
		.goodbad {			
			height:50pt;
			border:none;
			font-weight: bold;
			font-size: 200%;
		}
		.invis {
			border:none;
		}
		#score {
			text-align: left;
			border:none;
			font-weight: none;
		}
		button {			
			/*border:none;*/
			font-weight: bold;
			font-size: 100%;
			/*width: 100%;*/
		}
		#goodbutton {
			background-color: lightgreen;
		}
		#badbutton {
			background-color: pink;
		}
	</style>
</head>
<body>
	<h1>Allgemeine Befehle der Göttin</h1>
	<p>

<table id="haupttabelle">
		<tr>
		<td class="emside">
		</td>
		<td class="goodbad" colspan="2">
			<button type="button" id="goodbutton"  accesskey="s">Thou shalt </button>
		</td>
		<td class="goodbad"  colspan="2">
			<button type="button" id="badbutton"  accesskey="n">Thou shalt <u>not</u></button>
		</td>
		<td class="emside">
		</td>
	</tr>
		<tr>
		<td class="emside">
		</td>
		<td id="score">
			Score:10
		</td>
		<td class="invis">
		</td>
		<td class="invis">
		</td>
		<td class="invis">
		</td>
		<td class="emside">
		</td>
	</tr>

	<tr class="oben">
		<td class="emside">
		</td>
		<td id="r1c1" class="oben obenleft">⋮
		</td>
		<td id="r1c4" class="oben obenright">⋮
		</td>
		<td id="r1c4" class="oben obenright">⋮
		</td>
		<td class="emside">
		</td>
	</tr>

</table>

<p>
	<button type="button" id="newgamebutton" >Spiel neustarten</button>
<script type="text/javascript">
	var state=[];

	var agent_zahl = 4;
	var gebot_zahl = 14;
	var vor_zeile_zahl = 2;


	var starthealth=6;


	var gutSchaltfläche;
	var böseSchaltfläche;
	var neuSchaltfläche;


	// var tugenden = [
	// // 'Demut','Mildtätigkeit','Keuschheit','Geduld','Mäßigung','Wohlwollen','Fleiß'
	// // 'humilitas','caritas','castitas','patientia','temperantia','humanitas','industria'
	// ];
	// var laster = [
	// // 'Hochmut','Habgier','Wollust','Zorn','Völlerei','Neid','Faulheit'
	// ];

	var tugenden = ['Chastity','Temperance','Charity','Diligence','Patience','Kindness','Humility'];

	var laster = ['Lust','Gluttony','Greed','Sloth','Wrath','Envy','Pride'];
	var worte = tugenden.concat(laster);
	
	function tugendsein(w){
		return tugenden.indexOf(w)>=0;
	}

	function getWort(){
		return worte[Math.floor(Math.random()*worte.length)];
	}

	function befehlWert(agent,wort){
		// return (wort.length%3)-1;

		for (var i=0;i<gebot_zahl;i++){
			var gebot = state.gebote[agent][i];
			if (gebot.length==0){
				continue;
			}
			if (gebot[0]==wort){
				return gebot[1];
			}
		}
		return 0;
	}

	function stellZustand(){

		for (var i=0;i<agent_zahl;i++){
			var elem = document.getElementById('health'+i);
			elem.innerHTML=state.healths[i];
		}

		for (var i=0;i<agent_zahl;i++){
			for (var j=0;j<vor_zeile_zahl;j++){
				var elem = document.getElementById(`v${j}c${i}`);
				console.log(i,j);
				var wort = state.vor[i][j];
				elem.innerHTML=hüllWort(wort,i);

				var wert = befehlWert(i,wort);
				switch(wert){
					case -1:
					elem.className="evil";
					break;
					case 0:
					elem.className="";
					break;
					case 1:
					elem.className="good";
					break;
				}
			}
		}

		for (var i=0;i<agent_zahl;i++){
			for (var j=0;j<gebot_zahl;j++){
				var elem = document.getElementById(`g${j}c${i}`);
				console.log(i,j);
				var gebot = state.gebote[i][j];
				if (gebot.length===0){
					elem.innerHTML="&nbsp;";
					elem.className="";
					continue;
				}
				var wert = befehlWert(i,gebot[0]);
				switch(wert){
					case -1:
					elem.className="evil";
					break;
					case 0:
					elem.className="";
					break;
					case 1:
					elem.className="good";
					break;
				}
				elem.innerHTML=hüllWort(gebot[0],-1);
			}
		}

		// state.gebote=[];
		// for (var i=0;i<agent_zahl;i++){
		// 	state.gebote.push([]);
		// 	for (var j=0;j<gebot_zahl;j++){
		// 		state.gebote[i].push(getWort());
		// 	}
		// }

		// state.reihe=[];
		for (var i=0;i<agent_zahl;i++){
			var elem = document.getElementById(`agw${i}`);
			var wort = state.reihe[i];
			elem.innerHTML=hüllWort(wort,i);


				var wert = befehlWert(i,wort);
				switch(wert){
					case -1:
					elem.className="evil";
					break;
					case 0:
					elem.className="";
					break;
					case 1:
					elem.className="good";
					break;
				}

		// 	state.reihe.push(getWort());
		}
	}

	function generiereTabelle(){

		var table = document.getElementById('haupttabelle');

		state={};
		state.healths=[];
		for (var i=0;i<agent_zahl;i++){
			state.healths.push(starthealth);
		}

		state.vor=[];
		for (var i=0;i<agent_zahl;i++){
			state.vor.push([]);
			for (var j=0;j<gebot_zahl;j++){
				state.vor[i].push(getWort());
			}
		}

		state.gebote=[];
		for (var i=0;i<agent_zahl;i++){
			state.gebote.push([]);
			for (var j=0;j<gebot_zahl;j++){
				state.gebote[i].push([]);
			}
		}

		state.reihe=[];
		for (var i=0;i<agent_zahl;i++){
			state.reihe.push(getWort());
		}

		var inner = "";

		for (var i=0;i<vor_zeile_zahl;i++){
			inner += `
	<tr>
		<td class="emside">
		</td>`

			for (var j=0;j<agent_zahl;j++){
				inner +=`<td id="v${i}c${j}">
			platzhalter
		</td>`
			}

			inner +=`
		<td class="emside">
		</td>
	</tr>`

		}

		inner+= `
	<tr id="ausgewählt">
		<td class="side">
			->
		</td>`


			for (var j=0;j<agent_zahl;j++){
				inner +=`<td id="agw${j}">
			platzhalter
		</td>`
			}

		inner+=`
		<td class="side">
			&lt;-
		</td>
	</tr>`

		inner+=`
	<tr class="status" id ="reihe">
		<td class="emside">
		</td>`


			for (var j=0;j<agent_zahl;j++){
				inner +=`
		<td id="health${j}">
			666
		</td>`
			}


		inner+=`
		<td class="emside">
		</td>
	</tr>`


		for (var i=0;i<gebot_zahl;i++){
			inner += `
	<tr>
		<td class="emside">
		</td>`

			for (var j=0;j<agent_zahl;j++){
				inner +=`<td id="g${i}c${j}">
			platzhalter
		</td>`
			}

			inner +=`
		<td class="emside">
		</td>
	</tr>`

		}
		table.innerHTML +=  inner;
	}

	function sollAnimieren(){		
		for (var i=0;i<agent_zahl;i++){
			var wort = state.reihe[i];
			if (befehlWert(i,wort)!=0){
				return true;
			}
		}
	}

	function tueTick(){
		for (var i=0;i<agent_zahl;i++){
			var wort = state.reihe[i];
			if (befehlWert(i,wort)!=0){
				var wert = befehlWert(i,wort);
				befehlSpalte(i,wert,false);
			}
		}
		stellZustand();

		if (sollAnimieren()){
			fangMitAutoAn();
		} else {
			gutSchaltfläche.disabled=false;
			böseSchaltfläche.disabled=false;
			neuSchaltfläche.disabled=false;
		}
	}

	function fangMitAutoAn(){
		gutSchaltfläche.disabled=true;
		böseSchaltfläche.disabled=true;
		neuSchaltfläche.disabled=true;

		setTimeout(tueTick,100);
	}

	function befehl(wert){
		for (var i=0;i<agent_zahl;i++){
			befehlSpalte(i,wert,true);
		}
		
		if (sollAnimieren()){
			fangMitAutoAn();
		}

		stellZustand();
	}

	function befehlSpalte(agent,wert,hinzufügen){
		var i=agent;
		//1 bewege gebote hinunter

		if (hinzufügen){
			for (var j=gebot_zahl-1;j>=0;j--){
				state.gebote[i][j+1]=state.gebote[i][j];
			}
		}

		//2 bewege die aktive Zeile hinunter + set wert

		if (hinzufügen){
			state.gebote[i][0]=[state.reihe[i],wert];
		}

			var delta=0;
			if (tugendsein(state.reihe[i])){
				delta=wert;
			} else {
				delta=-wert;
			}

			{
				var wort = 	state.reihe[i];

				//for every other character
				for (var o=0;o<agent_zahl;o++){
					if (o===agent){
						continue;
					}

					var tugend = tugendsein(wort);
					var o_does = befehlWert(o,wort);
					
					 // if you fail to do something good that they value, they will punish you
					if (wert==-1 && tugend===true && o_does===1){
						delta-=1;
					}

					//if you do something evil that they are not allowed to do, they will punish you
					if (wert==1 && tugend===false && o_does===-1){
						delta-=1;
					}
				}
				state.healths[i]+=delta;
			}

		//3 bewege die Vorschauzeile hinunter

			state.reihe[i]=state.vor[i][vor_zeile_zahl-1];


		//4 bewege Vorschauzeile hinunter

			for (var j=vor_zeile_zahl-1;j>=0;j--){
				state.vor[i][j+1]=state.vor[i][j];
			}

		//5 neuzeichnen

			state.vor[i][0]=getWort();


		//6 mit der animation anfangen, wenn relevant
	}

	function aufGutKlicken(){
		befehl(1);
	}
	
	function aufBöseKlicken(){
		befehl(-1);
	}
	
	function aufNeuKlicken(){
		generiereTabelle();
		stellZustand();
	}

	function hüllWort(w,agent){
		var tugend = tugendsein(w);

		if (agent>=0){
			var delta=0;

			for (var o=0;o<agent_zahl;o++){
				if (o===agent){
					continue;
				}

				var o_does = befehlWert(o,w);
				
				 // if you fail to do something good that they value, they will punish you
				if (tugend===true && o_does===1){
					delta++;
				}

				//if you do something evil that they are not allowed to do, they will punish you
				if (tugend===false && o_does===-1){
					delta++;
				}
			}
			if (delta!=0){
				w+='<sup>';
				for (var i=0;i<delta;i++){
					w+='†';
				}
				w+='</sup>';
			}
		}
		if (tugend){
			w = `<span class="tugend">${w}</span>`;
		} else {
			w = `<span class="laster">${w}</span>`;
		} 

		return w; 
	}

	function schließSchaltflächeAn(){

		gutSchaltfläche = document.getElementById('goodbutton');
		böseSchaltfläche = document.getElementById('badbutton');
		neuSchaltfläche = document.getElementById('newgamebutton');

		gutSchaltfläche.addEventListener("click", aufGutKlicken);
		böseSchaltfläche.addEventListener("click", aufBöseKlicken);
		neuSchaltfläche.addEventListener("click", aufNeuKlicken);

	}

	generiereTabelle();
	stellZustand();
	schließSchaltflächeAn();

</script>
</body>
</html>